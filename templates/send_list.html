
{% extends "base.html" %}
{% load static %}
{% block content %}
<body>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    body { font-family: 'Inter', sans-serif; color: oklch(var(--bc)); }
    
    html, body { height: 100%; }
    
    .layui-fluid { 
        padding: 30px; 
        min-height: calc(100vh - 110px);
        box-sizing: border-box;
    }
    
    /* 卡片容器 - 适配所有主题 */
    .layui-card {
        background-color: oklch(var(--b2) / 0.8);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid oklch(var(--bc) / 0.1);
        height: 100%;
        color: oklch(var(--bc));
    }
    
    .layui-card-body { padding: 20px; height: 100%; box-sizing: border-box; }
    
    /* daisyUI Table 样式 - 无竖线 */
    .layui-table-view {
        border: none !important;
        background-color: transparent !important;
    }
    
    .layui-table {
        width: 100% !important;
        border-collapse: collapse;
        background-color: transparent !important;
        color: oklch(var(--bc));
        font-size: 14px;
    }
    
    .layui-table-header {
        background-color: oklch(var(--b2)) !important;
    }
    
    .layui-table th {
        background-color: oklch(var(--b2)) !important;
        color: oklch(var(--bc) / 0.6) !important;
        font-weight: 600;
        font-size: 12px;
        padding: 12px 16px !important;
        border-bottom: 1px solid oklch(var(--bc) / 0.1) !important;
        border-right: none !important;
        border-left: none !important;
    }
    
    .layui-table th .layui-table-cell {
        padding: 0 !important;
        height: auto !important;
        line-height: 1.5 !important;
    }
    
    .layui-table td {
        padding: 12px 16px !important;
        border-bottom: 1px solid oklch(var(--bc) / 0.05) !important;
        border-right: none !important;
        border-left: none !important;
        background-color: transparent !important;
    }
    
    .layui-table tbody tr:hover td {
        background-color: oklch(var(--b3)) !important;
    }
    
    .layui-table-click td {
        background-color: oklch(var(--p) / 0.1) !important;
    }
    
    /* 分页样式修复 */
    .layui-laypage a, .layui-laypage span {
        background-color: transparent !important;
        color: oklch(var(--bc) / 0.7) !important;
        border-color: oklch(var(--bc) / 0.1) !important;
    }
    
    .layui-laypage .layui-laypage-curr .layui-laypage-em {
        background-color: oklch(var(--p)) !important;
    }
    
    .layui-laypage .layui-laypage-curr em {
        color: oklch(var(--pc)) !important;
    }

    /* 分页输入框和下拉框深色适配 */
    .layui-laypage input, .layui-laypage select {
        background-color: oklch(var(--b1)) !important;
        border: 1px solid oklch(var(--bc) / 0.1) !important;
        color: oklch(var(--bc)) !important;
    }
    
    .layui-laypage button {
        background-color: oklch(var(--b1)) !important;
        border: 1px solid oklch(var(--bc) / 0.1) !important;
        color: oklch(var(--bc) / 0.7) !important;
    }
    
    /* 修复表格 Loading 和空数据样式 */
    .layui-table-init, .layui-none {
        background-color: transparent !important;
        color: oklch(var(--bc) / 0.6) !important;
    }
    
    /* 按钮样式 */
    .layui-btn-normal {
        background: oklch(var(--er) / 0.15) !important;
        color: oklch(var(--er)) !important;
        border: 1px solid oklch(var(--er) / 0.3) !important;
        padding: 6px 12px !important;
        min-width: 80px;
        height: auto !important;
        line-height: 1.5 !important;
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
        gap: 4px;
        white-space: nowrap;
    }
    
    .layui-btn-normal:hover {
        background: oklch(var(--er) / 0.25) !important;
        color: oklch(var(--bc)) !important;
    }
    
    .layui-btn-sm {
        background-color: oklch(var(--su));
        color: oklch(var(--suc));
        height: auto !important;
        line-height: 1.5 !important;
        padding: 6px 12px !important;
        display: inline-flex !important;
        align-items: center;
        gap: 4px;
    }
    
    /* 隐藏固定列表格，避免重复显示 */
    .layui-table-fixed {
        display: none !important;
    }
    
    /* 表格对齐 */
    .layui-table-view .layui-table {
        width: 100% !important;
    }
    
    .layui-table-header,
    .layui-table-body {
        overflow-x: auto !important;
    }
    
    .layui-table-main {
        width: 100% !important;
    }
    
    /* 表格单元格样式 */
    .layui-table-cell {
        height: 40px !important;
        line-height: 40px !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
        cursor: pointer;
    }
    
    /* 点击展开 */
    .layui-table-cell.expanded {
        white-space: normal !important;
        height: auto !important;
        overflow: visible !important;
        background: oklch(var(--b1));
        position: relative;
        z-index: 10;
        padding: 8px !important;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .layui-table td {
        padding: 10px 8px !important;
    }
    
    /* daisyUI 按钮样式 */
    .layui-table-cell .btn {
        min-height: 24px;
        height: 24px;
        font-size: 12px;
    }
  </style>

  <div class="layui-fluid">
    <div class="layui-card">
      <div class="layui-card-body">
          <table id="LAY-app-forum-list" lay-filter="LAY-app-forum-list"></table>
          {% verbatim %}
            <script type="text/html" id="table-forum-list">
               {{#  if(d.send_key == 0){ }}
              <a class="btn btn-success btn-xs" lay-event="send">投递</a>
               {{#  } else { }}
              <a class="btn btn-error btn-xs" lay-event="send_1">取消</a>
               {{#  } }}
            </script>
          {% endverbatim %}
      </div>
    </div>
  </div>
  </body>
{% endblock %}

{% block js %}
  <script>
  layui.config({
    base: '{% static "layuiadmin/" %}' //静态资源所在路径
  }).extend({
    index: 'lib/index' //主入口模块
  }).use(['index', 'table', 'form'], function() {
      var $ = layui.$
          , form = layui.form
          , table = layui.table;
      
      // 表格配置 - 与数据检索一致
      table.render({
          elem: '#LAY-app-forum-list',
          url: '/send_list/',
          cols: [[
              {field: 'job_id', title: '#', width: 65, align: 'left'},
              {field: 'name', title: '职位名称',width: 180},
              {field: 'salary', title: '薪资', width: 90},
              {field: 'education', title: '学历', width: 100},
              {field: 'experience', title: '经验', width: 100},
              {field: 'place', title: '地点', width: 120},
              {field: 'company', title: '公司名称',width: 180},
              {field: 'label', title: '行业', width: 120},
              {field: 'scale', title: '规模', width: 100},
              {title: '操作', width: 80, align: 'center', toolbar: '#table-forum-list'}
          ]],
          page: true,
          limit: 15,
          limits: [15, 20, 30, 50],
          size: 'sm'
      });
      
      // 监听操作按钮
      table.on('tool(LAY-app-forum-list)', function(obj) {
          var data = obj.data;
          if (obj.event === 'send') {
              showConfirm('确定投递职位「' + data.name + '」吗？', function() {
                  $.ajax({
                      type: 'POST',
                      url: '/send_job/',
                      data: {job_id: data.job_id, send_key: data.send_key},
                      success: function(res) {
                          showToast(res.msg, 'success');
                          setTimeout(function() { location.reload(); }, 1000);
                      },
                      error: function() {
                          showToast('操作失败', 'error');
                      }
                  });
              }, {title: '投递确认', btnClass: 'btn-success'});
          } else if (obj.event === 'send_1') {
              showConfirm('确定取消投递「' + data.name + '」吗？', function() {
                  $.ajax({
                      type: 'POST',
                      url: '/send_job/',
                      data: {job_id: data.job_id, send_key: data.send_key},
                      success: function(res) {
                          showToast(res.msg, 'success');
                          setTimeout(function() { location.reload(); }, 1000);
                      },
                      error: function() {
                          showToast('操作失败', 'error');
                      }
                  });
              }, {title: '取消投递', btnClass: 'btn-error'});
          }
      });
      
      // 点击单元格展开/收起
      $(document).on('click', '.layui-table-body .layui-table-cell', function(e) {
          if ($(e.target).hasClass('btn') || $(e.target).closest('.btn').length) {
              return;
          }
          $('.layui-table-cell.expanded').not(this).removeClass('expanded');
          $(this).toggleClass('expanded');
      });
      
      // 点击其他地方收起
      $(document).on('click', function(e) {
          if (!$(e.target).closest('.layui-table-cell').length) {
              $('.layui-table-cell.expanded').removeClass('expanded');
          }
      });
  });
  </script>
{% endblock %}
